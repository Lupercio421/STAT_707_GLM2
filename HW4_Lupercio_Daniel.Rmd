---
title: "Home Work 4"
author: "Daniel L."
date: "4/28/2021"
output:
  pdf_document:
    extra_dependencies: ["amsmath"]
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, tidy.opts=list(width.cutoff=60),tidy=TRUE)
```

```{r, message=FALSE, error=FALSE}
library(tidyverse)
library(formatR)
```


Exercise 14.58 found on pdf page 672

Exercise 14.4, 14.7 & 14.9 found on page 659-660

Exercise 14.16 found on pdf page 662

Exercise 14.40 and 14.42 found on pdf page 668

---
Equation 14.26 found on pdf page 569

Equation 14.16 found on pdf page 595

Equation 14.34 found on pdf page 668

Equation 14.99 found on pdf page 645

## 14.4

### a. Plot the logistic mean response function (14.16) when $\beta_0 = -25$ and $\beta_1 = .2$ 

$$
E(Y_i) = \pi_i = F_L(\beta_0+\beta_1X_i) = \frac{1}{1+exp(-\beta_0 - \beta_1X_i)^{-1}}
$$
Creating a sequence of numbers from 100 to 160.

```{r}
x14 <- seq(100,160, by = .01)
```

Creating the probability weights from equation 14.17.

```{r}
e14 <- 1/(1+exp(25-.2*x14));
```

Plot:

```{r}
plot(e14, ylim = c(-0.3,1.3), xlab = "X", ylab = "Probability")
title(main = "Exercise 14.4 a.")
```

### b. For what value of X is the mean response equal to 0.5?

```{r}
df_14 <-as.data.frame(x14)
df_14_2 <- as.data.frame(e14)
df_14 <- cbind(df_14, df_14_2)
```

```{r}
#df_14 %>% filter(between(e14,0.499,0.5099))
#df_14 %>% filter(e14 == 0.5)
df_14 %>% select(x14) %>% filter(e14 == 0.5)
```

When the mean response equals 0.5, X = 125.

### c. Find the odds when $X=150$, when $X=151$, and the ratio fo the odds when $X=151$ to the odds when $X=150$. Is this odds ratio equal to exp($\beta_1$) as it should be?

```{r}
df_14 %>% filter(x14 == 150 | x14 == 151)
```


$$
\hat{\pi}' = log_e(\frac{0.9933071}{1-0.9933071}) = log_e(148.4121) = 4.999993
$$

When X = 150, the odds = 148.412.

$$
\hat{\pi}' = log_e\frac{0.9945137}{1-0.9945137} = log_e(181.2722) = 5.2
$$

When X = 151, the odds = 181.272.

The ratio for the odds when $X=151$ to the odds when $X=150$:

$$
log_e(181.2722) - log_e(148.4121)= log_e(\frac{181.2722}{148.4121}) = 0.20
$$

Thus, the difference between the two fitted logit response values does equal $b_1 = 0.20$. Also note that, $\frac{181.2722}{148.4121} = 1.221$.

$$
\hat{OR} = \frac{odds_2}{odds_1}=exp(b_1) = exp(.2) = 1.221
$$

#### We conclude that the odds ratio does equal $exp(b_1)=1.221$.

## 14.9 Performance ability

```{r}
performance <- read.csv("Problem_9_Data.csv", header = FALSE, sep = ",", col.names = c("Y","X"))
```


### a. Find the maximum likelihood estimates of $\beta_0$ & $\beta_1$. States the fitted response function. 

```{r}
performance_fit <- glm(Y~X, data = performance, family = binomial(link = "logit")); 
coefficients(performance_fit)
```

We see that $b_0 = -10.309$ and $b_1 = 0.0189$. The response function for our model is:

$$
E(Y_i) = \pi_i = F_L(\beta_0+\beta_1X_i) = \frac{exp(b_0 + b_1X_i)}{1+exp(b_0 + b_1X_i)} = \frac{exp(-10.309 + 0.0189X_i)}{1+exp(-10.309 + 0.0189X_i)}
$$

### b. Obtain a scatter plot of the data with both the fitted logistic response function from part (a) and a lowess smooth superimposed. Does the fitted logistic response function appear to fit well?

```{r}
# Create a sequence of points, similar to our X observations
x1 <- seq(min(performance$X), max(performance$X), by = .1)
```

Let us isolate the model coefficients and our probability weights.

```{r}
coeff1 <- coefficients(performance_fit)
p1 <- exp(coeff1[1]+coeff1[2]*x1)/(1+exp(coeff1[1]+coeff1[2]*x1))
performance_fitted <- performance_fit$fitted.values
```

Plot:

```{r}
plot(performance$X,performance$Y, ylim = c(-.5,1.5), xlab = "Emotional Stability", ylab = "Ability to Perform Task")
abline(h = 0, lty = 3)
abline(h = 1, lty = 3)
lines(x1,p1, lwd = 2, col =c("red"))
#lines(performance_fitted, lwd = 2, col = "blue")
title(main = "Scatter Plot")
```

### c. Obtain exp($b_1$) and interpret this number.

```{r}
exp(0.01891983)
100*1.0191
```

$\hat{OR}=exp(0.0189)= 1.0191$. The odds a person is able to perform in a group increases by 1.9% with an increase the score of emotional stability.

### d. What is the estimated probability that employees with an emotional stability test score of 550 will be able to perform in a task group?

```{r, echo = FALSE, results = "hide"}
#exp(coeff1[1]+coeff1[2]*550)/(1+exp(coeff1[1]+coeff1[2]*550))
```

```{r, echo = FALSE}
#options(width = 100)
#cat("The estimated probability that employees with an emotional stability test score of 550 will be able to perform in a task group is", signif(predict(performance_fit, type = "response", newdata = list(X = 550)),3))
predict(performance_fit, type = "response", newdata = list(X = 550))
```

#### The estimated probability that employees with an emotional stability test score of 550 will be able to perform in a task group is 0.524

### e. Estimate the emotional stability test score for which 70 percent of the employees with this test score are expected to be able to perform in a task group.

$$
\begin{split}
log_e(\frac{\hat{\pi}}{1-\hat{\pi}}) = \beta_0+\beta_1x_i \\
log_e(\frac{{0.70}}{1-{0.70}}) = -10.309 + 0.0189*x_i \\
0.8472979 = -10.309 + 0.0189*x_i \\
11.1563 = 0.0189*x_i \\ 
x_i = \frac{11.1563}{0.0189} \\
x_i = 590.2804
\end{split}
$$
An employee must score at least  590.28 in the emotional stability test for a 70% percent chance to be able to perform in a task group.

## 14.58

```{r}
CDI <- read.csv("CDI_data2.csv", header = T)
```

